{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TrisSEAS | Smart Entry & Attendance</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/home.css' %}">
</head>
<body>
    <div class="glow blur-a"></div>
    <div class="glow blur-b"></div>
    <header class="site-header">
        <div class="logo-mark">SEAS</div>
        <nav class="nav">
            <a href="#stack">Platform</a>
            <a href="/analytics/">Analytics</a>
            <a href="/notifications/">Notifications</a>
            <a href="/console/">Gate Console</a>
        </nav>
        <div class="nav-actions">
            <a class="btn ghost" href="/console/">Console</a>
            <a class="btn primary" href="/admin/panel/">Admin panel</a>
        </div>
    </header>

    <main>
        <section class="hero">
            <div class="hero-copy">
                <p class="eyebrow">TrisSEAS</p>
                <h1>Modern campus entry, live attendance, and trusted oversight.</h1>
                <p class="lede">Deploy a professional gate and attendance layer that blends biometrics, RFID, and instant analytics. Operators get a polished admin panel while staff view live snapshots that actually update.</p>
                <div class="hero-actions">
                    <a class="btn primary" href="/admin/">Open Django admin</a>
                    <a class="btn" href="/admin/panel/">View SEAS control room</a>
                </div>
                <div class="hero-meta">
                    <div>
                        <p class="meta-label">Live today</p>
                        <h3><span id="entriesToday">{{ snapshot.entries_today }}</span> entries</h3>
                    </div>
                    <div>
                        <p class="meta-label">Attendance</p>
                        <h3><span id="attendanceRate">{{ snapshot.attendance_rate }}</span>% present</h3>
                    </div>
                </div>
            </div>
            <div class="hero-visual">
                <div class="dash-card">
                    <div class="card-head">
                        <div>
                            <p class="card-label">Live snapshot</p>
                            <h3>Command status</h3>
                        </div>
                        <span class="pill success" id="livePill">Updating</span>
                    </div>
                    <div class="metric-grid">
                        <article class="metric">
                            <p class="muted">Total students</p>
                            <h2 id="totalStudents">{{ snapshot.total_students }}</h2>
                            <p class="delta">Synced from Student roster</p>
                        </article>
                        <article class="metric">
                            <p class="muted">Gate events</p>
                            <h2 id="totalEvents">{{ snapshot.total_events }}</h2>
                            <p class="delta">Rolling history</p>
                        </article>
                        <article class="metric">
                            <p class="muted">On campus now</p>
                            <h2 id="onCampus">{{ snapshot.present_records }}</h2>
                            <p class="delta">Based on attendance</p>
                        </article>
                        <article class="metric">
                            <p class="muted">Exits today</p>
                            <h2 id="exitsToday">{{ snapshot.exits_today }}</h2>
                            <p class="delta">Auto-tagged</p>
                        </article>
                    </div>
                    <div class="timeline" id="eventTimeline">
                        {% for event in snapshot.recent_events %}
                        <div class="timeline-row">
                            <div class="dot"></div>
                            <div>
                                <p class="timeline-title">{{ event.student_id }} · {{ event.name }}</p>
                                <p class="timeline-meta">{{ event.action|title }} · {{ event.timestamp|date:'H:i' }}</p>
                            </div>
                        </div>
                        {% empty %}
                        <p class="muted">No gate activity yet — run a scan in the console.</p>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </section>

        <section id="stack" class="stack">
            <div class="section-head">
                <div>
                    <p class="eyebrow">Streamlined stack</p>
                    <h2>Everything operators need in one polished surface.</h2>
                    <p class="lede">Curated control panels, live telemetry, and proactive notifications. The admin experience is tuned for quick triage and bulk actions.</p>
                </div>
                <div class="badges">
                    <span class="pill">Biometric-ready</span>
                    <span class="pill">RFID bridge</span>
                    <span class="pill">REST APIs</span>
                </div>
            </div>
            <div class="stack-grid">
                <article class="stack-card">
                    <img src="https://images.unsplash.com/photo-1498050108023-c5249f4df085?auto=format&fit=crop&w=900&q=80" alt="Dashboard" loading="lazy">
                    <div>
                        <h3>Admin control room</h3>
                        <p>Launch the redesigned admin panel to review attendance, push notifications, and take bulk actions without hunting through menus.</p>
                        <a class="text-link" href="/admin/panel/">Open control room →</a>
                    </div>
                </article>
                <article class="stack-card">
                    <img src="https://images.unsplash.com/photo-1520607162513-77705c0f0d4a?auto=format&fit=crop&w=900&q=80" alt="Analytics" loading="lazy">
                    <div>
                        <h3>Analytics cockpit</h3>
                        <p>Visualize gates by hour, weekly movement, and top traffic sources. Export-ready summaries keep leadership in the loop.</p>
                        <a class="text-link" href="/analytics/">Explore analytics →</a>
                    </div>
                </article>
                <article class="stack-card">
                    <img src="https://images.unsplash.com/photo-1525182008055-f88b95ff7980?auto=format&fit=crop&w=900&q=80" alt="Notifications" loading="lazy">
                    <div>
                        <h3>Notification center</h3>
                        <p>See alerts for after-hours activity, denied entries, and parent outreach in one place. Send responses without leaving the page.</p>
                        <a class="text-link" href="/notifications/">Review alerts →</a>
                    </div>
                </article>
            </div>
        </section>

        <section class="cta">
            <div>
                <p class="eyebrow">Hands-on</p>
                <h2>Test the live gate console.</h2>
                <p class="lede">Start the webcam, capture a frame, and simulate an entry or exit. Use the live snapshot to watch the numbers change in real time.</p>
                <div class="hero-actions">
                    <a class="btn primary" href="/console/">Launch console</a>
                    <a class="btn ghost" href="/api/live-snapshot/" target="_blank" rel="noreferrer">Live JSON feed</a>
                </div>
            </div>
            <div class="cta-card">
                <div class="chip">Live</div>
                <h3>Live snapshot</h3>
                <p class="muted">This component refreshes every 10 seconds and updates the hero metrics without reloading.</p>
                <div class="mini-grid">
                    <div>
                        <p class="muted">Entries</p>
                        <h3 id="miniEntries">{{ snapshot.entries_today }}</h3>
                    </div>
                    <div>
                        <p class="muted">Attendance</p>
                        <h3 id="miniAttendance">{{ snapshot.attendance_rate }}%</h3>
                    </div>
                    <div>
                        <p class="muted">On campus</p>
                        <h3 id="miniOnCampus">{{ snapshot.present_records }}</h3>
                    </div>
                    <div>
                        <p class="muted">Exits</p>
                        <h3 id="miniExits">{{ snapshot.exits_today }}</h3>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="footer">
        <div>
            <p class="muted">TrisSEAS · Secure Entry & Attendance System</p>
            <p class="muted">Built for campuses that need trustworthy automation.</p>
        </div>
        <div class="footer-links">
            <a href="/api/">API index</a>
            <a href="/analytics/">Analytics</a>
            <a href="mailto:support@trisseas.local">Support</a>
        </div>
    </footer>

    <script>
        async function refreshSnapshot() {
            const pill = document.getElementById('livePill');
            try {
                const response = await fetch('/api/live-snapshot/');
                if (!response.ok) throw new Error('Failed');
                const data = await response.json();
                document.getElementById('totalStudents').textContent = data.total_students;
                document.getElementById('totalEvents').textContent = data.total_events;
                document.getElementById('onCampus').textContent = data.present_records;
                document.getElementById('exitsToday').textContent = data.exits_today;
                document.getElementById('entriesToday').textContent = data.entries_today;
                document.getElementById('attendanceRate').textContent = data.attendance_rate;
                document.getElementById('miniEntries').textContent = data.entries_today;
                document.getElementById('miniAttendance').textContent = `${data.attendance_rate}%`;
                document.getElementById('miniOnCampus').textContent = data.present_records;
                document.getElementById('miniExits').textContent = data.exits_today;
                pill.textContent = 'Live';
                pill.classList.remove('error');
                pill.classList.add('success');

                const timeline = document.getElementById('eventTimeline');
                timeline.innerHTML = '';
                if (data.recent_events.length === 0) {
                    const empty = document.createElement('p');
                    empty.className = 'muted';
                    empty.textContent = 'No gate activity yet — run a scan in the console.';
                    timeline.appendChild(empty);
                } else {
                    data.recent_events.forEach(event => {
                        const row = document.createElement('div');
                        row.className = 'timeline-row';
                        row.innerHTML = `
                            <div class="dot"></div>
                            <div>
                                <p class="timeline-title">${event.student_id} · ${event.name}</p>
                                <p class="timeline-meta">${event.action.charAt(0).toUpperCase() + event.action.slice(1)} · ${new Date(event.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</p>
                            </div>
                        `;
                        timeline.appendChild(row);
                    });
                }
            } catch (error) {
                pill.textContent = 'Offline';
                pill.classList.remove('success');
                pill.classList.add('error');
            }
        }

        refreshSnapshot();
        setInterval(refreshSnapshot, 10000);
    </script>
</body>
</html>
